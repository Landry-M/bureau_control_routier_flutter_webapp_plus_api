# Configuration PHP pour augmenter les limites d'upload
# Taille maximale des fichiers uploadés : 100MB
php_value upload_max_filesize 100M

# Taille maximale des données POST : 100MB
php_value post_max_size 100M

# Temps d'exécution maximum : 600 secondes (10 minutes)
php_value max_execution_time 600

# Temps d'entrée maximum : 600 secondes
php_value max_input_time 600

# Mémoire maximale : 512MB
php_value memory_limit 512M

# Nombre maximum de fichiers uploadés simultanément
php_value max_file_uploads 50

# Variables d'entrée maximum
php_value max_input_vars 3000

# Taille maximale du buffer d'output
php_value output_buffering 4096

# Autoriser les uploads de fichiers
php_flag file_uploads On

# Headers CORS sécurisés pour API
SetEnvIf Origin "^https://controls\.heaventech\.net$" CORS_ORIGIN=$0
SetEnvIf Origin "^https://control\.heaventech\.net$" CORS_ORIGIN=$0
SetEnvIf Origin "^https://api\.bcr\.heaventech\.net$" CORS_ORIGIN=$0
SetEnvIf Origin "^http://localhost:8000$" CORS_ORIGIN=$0
SetEnvIf Origin "^http://127\.0\.0\.1:8000$" CORS_ORIGIN=$0

Header always set Access-Control-Allow-Origin "%{CORS_ORIGIN}e" env=CORS_ORIGIN
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
Header always set Access-Control-Allow-Credentials "true"

# Configuration pour les fichiers PHP
<Files "*.php">
    php_value upload_max_filesize 100M
    php_value post_max_size 100M
    php_value max_execution_time 600
    php_value max_input_time 600
    php_value memory_limit 512M
    php_value max_input_vars 3000
    php_flag file_uploads On
</Files>

# Protection des dossiers sensibles
<Directory "uploads">
    Options -Indexes
    <FilesMatch "\.(php|phtml|php3|php4|php5|pl|py|jsp|asp|sh|cgi)$">
        Deny from all
    </FilesMatch>
</Directory>

# Redirection pour API PHP
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^api/(.*)$ api/routes/index.php [QSA,L]
